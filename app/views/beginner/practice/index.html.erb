<div id="start">
    <p>大変だ!注文のピークがきてしまった!</p>
    <p>急いでピザを作らなきゃ!!</p>
    <p>クリックするとスタートします</p>
</div>
<div id="game">
    <h1></h1>
    <div id="field">
        <div id="answer-area">
            <div class="answer">1</div>
            <div class="answer">2</div>
            <div class="answer">3</div>
            <div class="answer">4</div>
            <div class="answer">5</div>
            <div class="answer">6</div>
            <div class="answer">7</div>
            <div class="answer">8</div>
            <div class="answer">9</div>
            <div class="answer">10</div>
        </div>
        <div id="select-area">
            <div class="select">1</div>
            <div class="select">2</div>
            <div class="select">3</div>
            <div class="select">4</div>
            <div class="select">5</div>
            <div class="select">6</div>
            <div class="select">7</div>
            <div class="select">8</div>
            <div class="select">9</div>
            <div class="select">10</div>
        </div>
    </div>
    <div id="btn">
        <button onclick="showQuestion()">リセット</button>
    </div>
</div>
<div id="next">

</div>

<script>
//問題
var question = [];

monster_recipes = gon.monster_recipes
monster_names = gon.monster_names

for (let i = 0; i < monster_recipes.length ; i++) {
    question.push({"q":monster_names[i],"a":monster_recipes[i]})
}

//top画面
const scenetop = document.querySelector("#start");
//game画面
const scecegame = document.querySelector("#game");
//正解不正解表示画面
const next = document.querySelector("#next");
const field = document.querySelector("#field");
const select = document.querySelectorAll(".select");
const answer = document.querySelectorAll(".answer");

//選択された答えを順番に格納
let answers = [];
//問題番号を管理
let questionnum = 0;


init();
function init() {
    changescene(scecegame, scenetop);
    scenetop.addEventListener('click', gamestart, false);
}

function changescene(hiddenscene, visiblescene) {
    hiddenscene.classList.add("is-hidden");
    hiddenscene.classList.remove("is-visible");
    visiblescene.classList.add("is-visible");
}

function gamestart() {
    changescene(scenetop, scecegame);
    showQuestion()
}

//並べ替えクイズの処理
function showQuestion() {
    //答えを格納している配列を初期化
    answers.length = 0; 
    for (let i = 0; i < 6; i++) {
        answer[i].textContent = i + 1;
    }

    //問題の解答シャッフル Fisher–Yatesアルゴリズムを用いる
    //値渡しコピーで配列に代入
    let shufflea = question[questionnum].a.concat(); 
    for (let i = shufflea.length - 1; i > 0; i--) {
        let r = Math.floor(Math.random() * (i + 1));
        let tmp = shufflea[i];
        shufflea[i] = shufflea[r];
        shufflea[r] = tmp;
    }

    //問題文挿入
    document.querySelector("h1").textContent = question[questionnum].q;
    //回答選択肢挿入
    for (let i = 0; i < shufflea.length; i++) {
        select[i].classList.remove('is-hidden');
        select[i].textContent = shufflea[i];
    }

    let count = 0;
    //選択された答えを消す 
    for (let i = 0; i < shufflea.length; i++) {
        select[i].onclick = () => {
            console.log(count);
            select[i].classList.add('is-hidden');
            //選択された答えを移動
            answer[count].textContent = select[i].textContent;
            answers.push(answer[count].textContent);
            count += 1;
            if (count == shufflea.length) {
                count = 0;
                Judgment();
            }
        }
    }
}

//正解かどうか判定
function Judgment() {
    changescene(scecegame, next);
    if (JSON.stringify(question[questionnum].a) == JSON.stringify(answers)) {
        next.innerHTML = "<p style='font-size:3em;color:#f00;'>正解です！!</p><button onclick='nextquestion()'>次の問題</button>";
    } else {
        next.innerHTML = "<p style='font-size:3em;color:#000;'>不正解...</p><button onclick='nextquestion()'>次の問題</button><p style='font-size:3em;color:#000;'>正解の並び</p>" + JSON.stringify(question[questionnum].a) + "<p style='font-size:3em;color:#000;'>あなたの答え</p>" + JSON.stringify(answers);
    }
}


//次の問題ボタンが押された時の処理
function nextquestion() {
    questionnum++
    if (Object.keys(question).length > questionnum) {
        changescene(next, scecegame);
        showQuestion();
    } else {
        // クイズが終了した場合
        window.location.href = 'http://localhost:3000/beginner/practice/result'
    }
}

</script>